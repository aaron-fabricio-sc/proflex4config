/**
 @preserve
 Copyright (c) 2001-2021 by Wincor Nixdorf International GmbH,
 Heinz-Nixdorf-Ring 1, 33106 Paderborn, Germany

 This software is the confidential and proprietary information
 of Diebold Nixdorf.
 You shall not disclose such Confidential Information and shall
 use it only in accordance with the terms of the license agreement
 you entered into with Diebold Nixdorf.


$MOD$ ko.CustomUtils.js 4.3.1-210624-21-ae6e96c6-1a04bc7d
 */
define(["jquery","knockout","ui-content","lib/hammer.min","extensions","config/Config","vm-util/UIMovements","lib/jquery.transit.min","lib/jquery.inputfit"],(function(e,t,r,n,a,i,o){"use strict";const s=".svg",l="GUI_",d=t.bindingHandlers;return t.onError=function(e){Wincor.UI.Service.Provider.LogProvider.error(`Knockout binding error: ${e}`)},d.visibility=function(){function r(r,n){const a=t.unwrap(n());e(r).css("visibility",a?"visible":"hidden")}return{init:r,update:r}}(),d.iconimage={update:function(e,r,n,a,o){o.$root.compositionUpdatedObservable&&o.$root.compositionUpdatedObservable();let d=r(),c=o.$root,g=null,u=null;function p(t){e.setAttribute("style","display: none;"),t&&c.logger.LOG_DETAIL&&c.logger.log(c.logger.LOG_DETAIL,"* ko.bindingHandlers.iconimage::init "+t+" Image element will be set display=none")}if(d.hasOwnProperty("name")){let r=t.unwrap(d.name);g=d.hasOwnProperty("path")&&-1!==d.path.indexOf("/")?d.path:i.ROOT_DEFAULT+i.RVT_DEFAULT_NAME+i.IMAGE_FOLDER_NAME,g&&-1!==g.indexOf("/")?r||-1!==r.indexOf(l)?(d.hasOwnProperty("icondefault")&&(u=t.unwrap(d.icondefault)),-1!==r.lastIndexOf(".")?e.src=g+r:c.designMode?u?e.src=g+u:p("icon for HTML image element is missing! Binding attribute name='"+r+"' attribute 'icondefault' not set."):(r=c.replaceViewKeyPattern(r),c.serviceProvider.LocalizeService.getText([r],(t=>{void 0!==t[r]&&null!==t[r]?(e.src=g+t[r],c.logger.LOG_DETAIL&&c.logger.log(c.logger.LOG_DETAIL,"from localize service icon name="+t[r]),-1===t[r].indexOf(s)&&p(null)):u?(e.src=g+u,c.logger.LOG_DETAIL&&c.logger.log(c.logger.LOG_DETAIL,"from view default icon name="+t[r])):p("icon for HTML image element is missing! Binding attribute name='"+r+"' key not configured nor attribute 'icondefault' set.")})))):p("icon for HTML image element is missing! Binding attribute name='"+r+"' seems to invalid or even empty and doesn't contain a valid image file name nor a 'GUI_...' key for it."):c.logger.error("'path' for image resource is invalid path="+g)}else c.logger.error("'name' mandatory attribute is not given!")}},d.svguse={reqMap:new Map,update:async function(r,n,a,o,c){c.$root.compositionUpdatedObservable&&c.$root.compositionUpdatedObservable();const g=n(),u=c.$root,p=e(r),m=e("body"),f="svgDef_",b="svgDefCon_",v="_clone",y="<script ",h="<\/script>";let E=null,O="";const w=!!g.hasOwnProperty("createobject")&&("true"===g.createobject||!0===g.createobject),T=!!g.hasOwnProperty("inline")&&("true"===g.inline||!0===g.inline),A=g.hasOwnProperty("afterRender")?g.afterRender:null,S=!!g.hasOwnProperty("keepscript")&&("true"===g.keepscript||!0===g.keepscript);function _(e,t=!1){r.setAttribute("style","display: none;"),e&&(t?u.logger.error(`* ko.bindingHandlers.svguse::update ${e} SVG element will be set display=none for viewkey=${u.vmContainer.currentViewKey}`):u.logger.LOG_DETAIL&&u.logger.log(u.logger.LOG_DETAIL,`* ko.bindingHandlers.svguse::update ${e} SVG element will be set display=none`))}function x(e,t,r){return`${e.substr(0,r)}${t}${e.substr(r)}`}function P(e){return T?m.find(`#svgDefCon_${e}`):m.find(`#svgDef_${e}`)}async function I(t,r){let n=P(t);if(w||n.length||(n=await function(t,r){const n=T?`svgDefCon_${t}`:`svgDef_${t}`;if(d.svguse.reqMap.has(n))return d.svguse.reqMap.get(n);{const a=new Promise(((a,i)=>{e.ajax({url:r+t+s,type:"get",dataType:"text",contentType:!1,processData:!1,success:r=>{let o=P(t);if(o.length)a(o);else if(r)try{let n,o=(r=(r=r.replace('<?xml version="1.0" encoding="utf-8"?>',"")).replace('@import "../default/default/svg.css";',"")).indexOf("\x3c!--"),l=!1;if(-1!==o&&(n=r.indexOf("--\x3e"),n>o?r=`${r.substring(0,o)}${r.substr(n+"--\x3e".length)}`:u.logger.error(`svguse: Could not detect comment tag as expected for SVG=${t+s}`)),T||(o=r.indexOf('"preserve">'),-1!==o?r=x(r,`<symbol id="${t}_group">`,o+11):(o=r.indexOf("<svg "),-1!==o?(o=r.indexOf(">",o),-1!==o&&"svg>"!==r.substr(o-3,4)?r=x(r,`<symbol id="${t}_group">`,o+1):(l=!0,i(`svguse: Problem to parse SVG=${t+s} regarding begin svg tag end. Expecting '<svg ... >'`))):(l=!0,i(`svguse: Problem to parse SVG=${t+s} regarding begin svg tag. Expecting '<svg ... >'`))),n=r.indexOf("</svg>"),r=x(r,"</symbol>",n-1)),S)o=r.lastIndexOf("<![CDATA["),-1===o||r.substr(o).includes("document.")||(n=(r=x(r,` document.${t} = function() { `,o+9)).lastIndexOf("]]>"),r=x(r," } ",n-1));else for(o=r.indexOf(y);-1!==o&&!l;)n=r.indexOf(h),n>o?o=(r=`${r.substring(0,o)}${r.substr(n+h.length)}`).indexOf(y):(l=!0,o=-1,i(`svguse: Could not detect script tag as expected for SVG=${t+s}`));if(!l){let n=e(r);n.css({display:r.includes('="url(')?"":"none","max-width":0,"max-height":0}),n.attr({id:`${T?b+t:f+t}`,"area-hidden":"true"}),S&&n.attr("data-java-script","true"),m.append(n),a()}}catch(e){i(`svguse: Error while handle SVG reference for ${t+s}, error: ${e}`)}else i(`svguse: No data for SVG reference for ${t+s}`);d.svguse.reqMap.delete(n)},error:(e,r,a)=>{d.svguse.reqMap.delete(n),i(`svguse: AJAX error while handle svg reference for ${t+s}, error: ${a}`)}})}));return d.svguse.reqMap.set(n,a),a}}(t,r),n=n||P(t)),T){let e=p.attr("class");if(e&&e.includes(`${t}_clone`))"function"==typeof A&&A(p[0],u);else{e&&e.includes(v)&&(p.empty(),e=e.replace(p.attr("data-clone-name"),""),p.attr("class",e));let r=n.clone(),a=p.attr("id");const i=n.prop("attributes");for(let e=0;e<i.length;e++){let t=i[e];"id"!==t.name&&"style"!==t.name&&"area-hidden"!==t.name&&p.attr(t.name,t.value)}if(a&&p.attr("id",a),p.attr("data-clone-name",`${t}_clone`),p.addClass(`${t}_clone`),p.append(r.children()),"function"==typeof A&&A(p[0],u),"true"===n.attr("data-java-script")){let e=p[0].ownerDocument[t];"function"==typeof e&&e()}}}else if(w){let n=p.attr("id"),a=e(`<object type="image/svg+xml" data="${r}${t}.svg"></object>`),i=p.prop("attributes");e.each(i,((e,t)=>{a.attr(t.name,t.value)})),n?a.attr("id",n):a.removeAttr("id"),p.replaceWith(a)}else{let e=n.attr("viewBox");e&&p.attr("viewBox",`${e}`);let r=n.attr("width");r&&p.attr("width",`${r}`);let a=n.attr("height");a&&p.attr("height",`${a}`),p.html(`<use class="${t}_group" href="#${t}_group"/>`)}}if(g.hasOwnProperty("name")||g.hasOwnProperty("svgname")){let e=t.unwrap(g.name)||t.unwrap(g.svgname);if(E=g.hasOwnProperty("path")&&g.path.includes("/")?g.path:`${i.ROOT_DEFAULT}${i.RVT_DEFAULT_NAME}${i.IMAGE_FOLDER_NAME}`,E&&E.includes("/"))if(e&&(e.includes(s)||e.includes(l)))if(g.hasOwnProperty("icondefault")&&(O=t.unwrap(g.icondefault)),p.attr("style")&&"none"===p.css("display")&&p.attr("style","display: initial;"),e.includes(s))try{await I(e.substr(0,e.indexOf(s)),E)}catch(e){_(e,!0)}else if(u.designMode)if(O)try{await I(O.substr(0,O.indexOf(s)),E)}catch(e){_(e,!0)}else _(`icon for HTML svg element is missing! binding attribute name='${e}' attribute 'icondefault' not set.`);else{if(e=u.replaceViewKeyPattern(e),e=(await u.serviceProvider.LocalizeService.getText(e))[e],null!=e){if(e)try{await I(e.substr(0,e.indexOf(s)),E)}catch(e){_(e,!0)}u.logger.LOG_DETAIL&&u.logger.log(u.logger.LOG_DETAIL,`from localize service icon name=${e}`),e.includes(s)||_(null)}else if(O){try{await I(O.substr(0,O.indexOf(s)),E)}catch(e){_(e,!0)}u.logger.LOG_DETAIL&&u.logger.log(u.logger.LOG_DETAIL,`from view default icon name=${e}`)}else _(`icon for HTML svg element is missing! Binding attribute name='${e}' key not configured nor attribute 'icondefault' set.`)}else _(`icon for HTML svg element is missing! Binding attribute name='${e}' seems to invalid or even empty and doesn't contain a valid SVG file name nor a 'GUI_...' key for it.`);else _(`'path' for svg resource is invalid path=${E} for name='${e}'`,!0)}else _("'name' mandatory attribute is not given!",!0)}},d.animateVisible={init:function(t,r,n){const a=n();t.context={jqElem:e(t),duration:a.animateVisible.duration||"0.4s",animIn:a.animateVisible.animIn||"fadeIn",animOut:a.animateVisible.animOut||"fadeOut",display:e(t).css("display")}},update:function(e,r){const n=t.unwrap(r().visible),a=e.context;n?(a.jqElem.bind("animationend",(()=>{a.jqElem.css("animation","none"),a.jqElem.unbind()})),a.jqElem.css({animation:a.animIn+" "+a.duration+" ease-in",display:"flex"})):"none"!==a.jqElem.css("display")&&(a.jqElem.bind("animationend",(()=>{a.jqElem.css({display:a.display,animation:"none"}),a.jqElem.unbind()})),a.jqElem.css({animation:a.animOut+" "+a.duration+" ease-out"}))}},d.slideVisible={update:function(r,n,a,o,s){const l=n(),d=a(),c=t.unwrap(l.visible),g=d.slideVisible.duration||400;!0===c?i.VIEW_ANIMATIONS_ON?s.$root.vmContainer.activationWorkingQueue.add(Wincor.UI.promise((t=>e(r).slideDown({duration:g,easing:"easeOutSine",complete:t})))):e(r).css("display",""):i.VIEW_ANIMATIONS_ON?s.$root.vmContainer.activationWorkingQueue.add(Wincor.UI.promise((t=>e(r).slideUp({duration:g,easing:"easeInSine",complete:t})))):e(r).css("display","none")}},d.fadeVisible={update:function(r,n,a){const o=n(),s=a(),l=t.unwrap(o),d=s.fadeVisible.duration||400;!0===l||!0===l.visible?i.VIEW_ANIMATIONS_ON?e(r).transition({opacity:1},d):e(r).css("opacity","1"):i.VIEW_ANIMATIONS_ON?e(r).transition({opacity:0},d):e(r).css("opacity","0")}},d.virtualExtend={init:function(e,r,n,a,i){const o=r(),s=i.$root,l=Object.keys(o);let d=!1;for(let e=l.length-1;e>=0;e--){let t=l[e];i.$index&&(d=!0),s.__virtualExtensions||(s.__virtualExtensions=[]),s[t]?s.__virtualExtensions&&-1!==s.__virtualExtensions.indexOf(t)?d&&Array.isArray(s[t])&&(s[t][i.$index()]=o[l[e]]):s.logger.error("ko.bindingHandlers.virtualExtend: The attribute "+t+" originally exists in the viewModel for "+s.observableAreaId):(d?(s[t]=[],s[t][i.$index()]=o[l[e]]):s[t]=o[t],s.__virtualExtensions.push(t))}t.utils.domNodeDisposal.addDisposeCallback(e,function(){if(this.__virtualExtensions){for(let e=this.__virtualExtensions.length-1;e>=0;e--)this[this.__virtualExtensions[e]]=null,delete this[this.__virtualExtensions[e]];delete this.__virtualExtensions}}.bind(s))}},d.csshref={init:function(e,t,r,n,a){},update:function(e,r,n,a,i){let o,s=r(),l=i.$root;s.hasOwnProperty("href")&&(t.isObservable(s.href)||"function"==typeof s.href)?(o=s.href(),o&&e.href&&-1===e.href.indexOf(o.substr(o.indexOf("style")))&&(e.href=o)):l.logger.error("* ko.bindingHandlers.csshref::update 'href' mandatory attribute is not given or argument for it is not a function type!")}},d.format={init:function(e,r,n,a,i){t.utils.domNodeDisposal.addDisposeCallback(e,function(t){t.triggerFormat&&(t.triggerFormat=null,delete t.triggerFormat),e.formatSource=e.formatTarget=e.formatPlaceHolderSource=e.formatPlaceHolderTarget=null}.bind(null,i));const o=i.$root,s=r();if(!o.designMode){let e=o.serviceProvider.LocalizeService;e.registerForServiceEvent(e.SERVICE_EVENTS.LANGUAGE_CHANGED,(function(){i.triggerFormat&&i.triggerFormat()}),o.serviceProvider.ViewService.DISPOSAL_TRIGGER_UNLOAD)}s.hasOwnProperty("pattern")?e.formatPattern=s.pattern:o.logger.error("* ko.bindingHandlers.format::init 'pattern' attribute required!"),s.hasOwnProperty("src")?e.formatSource=s.src:o.logger.error("* ko.bindingHandlers.format::init 'src' attribute required!"),s.hasOwnProperty("target")&&(t.isObservable(s.target)?e.formatTarget=s.target:o.logger.error("* ko.bindingHandlers.format::init 'target' attribute must be an ko.observable!")),s.hasOwnProperty("showLastInputOnSecure")&&(t.isObservable(s.showLastInputOnSecure)?(e.showLastInputOnSecure=s.showLastInputOnSecure,e.lastInputDelay=s.lastInputDelay||250):o.logger.error("* ko.bindingHandlers.format::init 'showLastInputOnSecure' attribute must be an ko.observable!")),s.hasOwnProperty("placeholder_src")&&(e.formatPlaceHolderSource=s.placeholder_src),s.hasOwnProperty("placeholder_target")?t.isObservable(s.placeholder_target)?e.formatPlaceHolderTarget=s.placeholder_target:o.logger.error("* ko.bindingHandlers.format::init 'placeholder_target' attribute must be an ko.observable!"):void 0!==e.formatPlaceHolderSource&&o.logger.error("* ko.bindingHandlers.format::init 'placeholder_target' attribute required when 'placeholder_src' exists!"),s.hasOwnProperty("suffix")&&(e.suffix=s.suffix)},update:function(e,r,n,a,i){const o=i.$root;function s(r,n){let a=t.unwrap(r),i=t.unwrap(e.formatPattern);if(null==a)o.logger.error("ko.bindingHandlers.format::getFormatted value is invalid: "+r),n("NaN");else if(o.designMode){if(""!==a){let e=parseInt(o.bankingContext.currencyData.exponent),t="",r="";switch(i&&-1!==i.indexOf("#X")&&(t=i.substr(2),i="#X"),i&&-1!==i.indexOf("#x+-")&&(r=""+i,i="#x+-"),i){case"#M":a/=Math.pow(10,Math.abs(e)),a=parseFloat(a).toFixed(Math.abs(e)),a=o.bankingContext.currencyData.symbol+a;break;case"#C":a/=Math.pow(10,Math.abs(e)),a=parseFloat(a).toFixed(Math.abs(e));break;case"#aTRM0":a/=Math.pow(10,Math.abs(e));break;case"#ATRM0":let n=a&&a<100;a/=Math.pow(10,Math.abs(e)),n&&(a=parseFloat(a).toFixed(Math.abs(e))),a=o.bankingContext.currencyData.symbol+a;break;case"#X":a=a.toString().replace(/./g,t);break;case"#x+-":let i=a.toString().length,s="",l=parseInt(r.substring(r.indexOf(":")+1));for(let e=0;e<i-l;e++)s+="x";a=s+a.toString().substring(i-l,i);break;case"":break;case"NONE":case"none":break;default:a+="*"}}n(a)}else if(""===i)o.logger.error("Warning, ko.bindingHandlers.format::getFormatted pattern attribute is empty!"),n(a);else if("NONE"!==i.toUpperCase()){let e={raw:a.toString()};o.serviceProvider.FormatService.format(e,i,null,!0),o.logger.LOG_DETAIL&&o.logger.log(o.logger.LOG_DETAIL,"* ko.bindingHandlers.format::getFormatted="+e.result),n(e.result)}else n(a)}function l(){void 0===e.formatPlaceHolderSource||void 0===e.formatPlaceHolderTarget||void 0!==e.formatPlaceHolderSourceAsString&&e.formatPlaceHolderSourceAsString===t.unwrap(e.formatPlaceHolderSource)||(s(e.formatPlaceHolderSource,(t=>e.formatPlaceHolderTarget(t))),e.formatPlaceHolderSourceAsString=t.unwrap(e.formatPlaceHolderSource)),void 0!==e.formatTarget?s(e.formatSource,(r=>{if(t.unwrap(e.showLastInputOnSecure)){let n=t.unwrap(e.formatSource),a=n.length-1;e.formatTarget(r.substr(0,a)+n.substr(a)),setTimeout((()=>{e.formatTarget&&e.formatTarget(r)}),e.lastInputDelay)}else e.formatTarget(r)})):void 0!==e.formatSource&&s(e.formatSource,(r=>{d.text.update(e,(()=>{let n=e.suffix?e.suffix:"";return`${t.unwrap(r)}${t.unwrap(n)}`}))}))}l(),i.triggerFormat||(i.triggerFormat=l)}},t.observableArray.fn.getById=function(e){let t=this()||[],r={};for(let n=0;n<t.length;n++)if(t[n].id()===e){r=t[n];break}return r},d.command={init(e,r,a,o,s){const l=r();let d,c,g;const u=s.$root;let p=u.serviceProvider.AdaService,m=u.serviceProvider.ViewService;const f=!u.designMode&&m.viewContext.viewConfig&&m.viewContext.viewConfig.timeout!==m.immediateTimeout&&p&&(p.state!==p.STATE_VALUES.DONOTHING||"GUIDM"===Wincor.UI.Service.Provider.getInstanceName());l.hasOwnProperty("state")||(l.state=u.CMDSTATE.ENABLED),l.hasOwnProperty("action")||(l.action=u.onButtonPressed),l.hasOwnProperty("label")||(l.label=null),l.hasOwnProperty("adaType")||(l.adaType=null),l.hasOwnProperty("adaText")||(l.adaText=null),l.hasOwnProperty("adaTextPost")||(l.adaTextPost=null),l.hasOwnProperty("eppkey")||(l.eppkey=null);const b="CANCEL"===l.eppkey||"CORRECT"===l.eppkey||"CONFIRM"===l.eppkey;if(l.hasOwnProperty("adakey")||(u.logger.LOG_ANALYSE&&u.logger.log(u.logger.LOG_ANALYSE,"* ko.bindingHandlers.command.init, doPrepareAda = "+f),l.eppkey&&f&&b?l.adakey=u.getLabel(u.buildGuiKey("Button",l.eppkey,"ADA"))():l.adakey=null),!l.hasOwnProperty("id"))return void u.logger.error("* ko.bindingHandlers.command.init - command-binding missing mandatory option 'id'\nPage   : "+u.currentView+"\nArea   : "+u.observableAreaId+"\nElement: "+e.id);d=l.id;if(l.eppkey&&l.eppkeyConfig&&l.eppkeyConfig.keys){let r,n=0;const a=l.action,i=t.observable("");i.extend({notify:"always"}).subscribe((function(e){n=0;try{a.apply(u,e)}catch(e){u.logger.error(`ko.bindingHandlers.command: alphanumeric config: Error calling original action with argument '${d}' -> exception: ${e.message} `)}})),l.action=function(){if(!r)try{r=JSON.parse(t.unwrap(l.eppkeyConfig.keys())),u.subscribeToObservable(l.eppkeyConfig.keys,(e=>{try{r=JSON.parse(e)}catch(e){r=""}}))}catch(e){}const o={type:"keypress",eppkey:Array.prototype.slice.call(arguments,0),charIdx:n,target:l.eppkeyConfig.targetElement||e.id,observable:i,timeout:l.eppkeyConfig.timeout||1e3};if("object"==typeof r&&(Array.isArray(r)?o.confArray=r:o.confArray=r[o.eppkey[0]]),!o.confArray)return""!==l.eppkeyConfig.keys()&&u.logger.error(`ko.bindingHandlers.command: alphanumeric config: Input ${arguments[0]} -> invalid eppkeyConfig:keys ${r?JSON.stringify(r):r}`),void a.apply(u,arguments);let s=!1;"function"==typeof l.eppkeyConfig.handler&&(s=l.eppkeyConfig.handler(o)),s||u.viewHelper.alphanumericInputHandler(o);const d=Wincor.UI.Service.Provider.AdaService;u.designMode||d.state!==d.STATE_VALUES.SPEAK||d.speak(o.confArray[n],2),n>=o.confArray.length-1?n=0:n++}}let v;if(t.utils.domNodeDisposal.addDisposeCallback(e,function(t){if(u.cmdRepos.hasCommand(t)){let e=u.cmdRepos.get(t);u.viewStateKeys.includes(e.viewState.key)&&u.viewStateKeys.splice(u.viewStateKeys.indexOf(e.viewState.key),1)}else u.logger.error("Command-binding: no command '"+t+"' exists for DOM-element "+e.id);u.cmdRepos.removeCommand(t)}.bind(this,d)),l.hasOwnProperty("args")?Array.isArray(l.args)||(l.args=[l.args]):l.args=[d],l.hasOwnProperty("elementId")?e.id||(e.id=l.elementId):e.id||(e.id=(d+"_"+u.viewKey+"_generated").replace(/[^\w]/gi,"_")),e.__commandId_PCEFlexUI=d,c=l.state,g=l.label,u.cmdRepos.hasCommand(d)){let t=u.cmdRepos.get(d);t&&t.element&&t.element!==e&&u.logger.error("Command-binding: Command-Ids must be unique! Error processing element id '"+e.id+"'!  Command '"+d+"' already exists for DOM-element with id '"+t.element.id+"'!")}else if(u.cmdRepos.createCommand(d),!u.designMode){let e=u.serviceProvider.ViewService;u.cmdRepos.addDelegate({id:d,context:u,delegate:function(){e.refreshTimeout()},priority:!0})}v=u.cmdRepos.get(d),v.viewModel=u;let y=!1;if(u.designMode||(y=p&&p.state===p.STATE_VALUES.SPEAK),l.eppkey){let e=l.eppkey;Array.isArray(e)?v.eppKeys=e.map((e=>e.toString())):"HELP"===e&&y||(v.eppKeys=[e.toString()]),u.logger.LOG_DETAIL&&u.logger.log(u.logger.LOG_DETAIL,`* ko.bindingHandlers.command.init, command '${v.id}' has eppKeys '${v.eppKeys}'`)}null!==l.adakey&&(v.adaKey=l.adakey,u.logger.LOG_DETAIL&&u.logger.log(u.logger.LOG_DETAIL,`* ko.bindingHandlers.command.init, command '${v.id}' has adaKey '${v.adaKey}'`)),v.element=e,l.adaType&&(v.adaType=l.adaType),l.adaText&&(v.adaText=l.adaText),l.adaTextPost&&(v.adaTextPost=l.adaTextPost);let h=e.outerHTML.match(/label:\s*\{[\s\w:\n'",]*getLabel\(\s*['"]([\[\]#\w]+)/),E="";h&&(E=u.replaceViewKeyPattern(h[1])),v.textKey=E;let O=l.adaType&&(l.adaType===u.ADA_TYPE.SELECTION_KEY||l.adaType===u.ADA_TYPE.FUNCTION_KEY||l.adaType===u.ADA_TYPE.STANDARD_KEY);l.hasOwnProperty("type")?v.type=l.type:O&&(v.type=u.CMDTYPE.BUTTON),null!==v.adakey&&E&&O&&(v.adaText||(v.adaText=u.getLabel(`${E}_ADA`,u.getLabel(E,l.label?l.label.text?l.label.text:"argh":d)())),v.adaTextPost||(v.adaTextPost=u.getLabel(`${E}_ADA_Clicked`,u.getLabel(E,l.label?l.label.text?l.label.text:"argh":d)())));let w=t.unwrap(c);v.setInitialViewState(-1!==w?w:0)&&u.logger.LOG_DETAIL&&u.logger.log(u.logger.LOG_DETAIL,"* command-binding setting initialViewState for "+v.id+" to "+c),c!==u.CMDSTATE.NONE&&(c=u.extractViewStateFromConfig(v,c));let T=!0;switch(c){case u.CMDSTATE.ENABLED:v.viewState.value(c);break;case u.CMDSTATE.DISABLED:case u.CMDSTATE.HIDDEN:case u.CMDSTATE.PRESSED:v.viewState.value(c);break;case u.CMDSTATE.NONE:v.viewState.value(c),T=!1,v.ignoreState=!0;break;default:isNaN(c)&&t.isObservable(c)?v.viewState.redirect(c):u.logger.error("* ko.bindingHandlers.command.init - invalid option 'state'\nState  : type="+typeof c+" value="+c+"\nPage   : "+u.currentView+"\nArea   : "+u.observableAreaId+"\nElement: "+e.id)}const A=v.delegates;if(null!==l.action){if(A.hammer){let e=A.hammer;u.logger.LOG_DETAIL&&u.logger.log(u.logger.LOG_DETAIL,"* ko.bindingHandlers.command removing hammer from "+d),e.off("tap"),e.off("pressup"),e.remove("Tap"),e.remove("Press"),e.destroy(),A.hammer=null}A._init(l.action,u,l.args)}g&&(g.hasOwnProperty("inplace")||(g.inplace=!1));const S={};if(T&&(S.visibility=v.isVisible.value,S.enabled=v.isActive.value),l.action){A.hammer=new n.Manager(e);let t=l.tap||l.Tap||i.GESTURE_CONFIG.Tap;A.hammer.add(new n.Tap(t)),A.handlers||(A.handlers={}),A.handlers.tap=function(e,t,r){t(r)}.bind(this,v,A._execute);let r=["tap"],a=l.press||l.Press||i.GESTURE_CONFIG.Press;a&&(A.hammer.add(new n.Press(a)),r.push("pressup")),A.hammer.on(r.join(" "),function(e,t){u.viewHelper.commandAutomation(e.element.id,t)}.bind(null,v))}if(g){let e;g.hasOwnProperty("html")?e="html":g.hasOwnProperty("text")?e="text":g.hasOwnProperty("value")?e="value":g.hasOwnProperty("textInput")&&(e="textInput"),v.label=g[e],g.inplace&&("html"===e?S.html=v.label:"text"===e?S.text=v.label:"value"===e?S.value=v.label:"textInput"===e&&(S.textInput=v.label))}t.applyBindingsToNode(e,S,s),u.cmdRepos.ensure(d)},update:function(t,r,n,a,i){const o=i.$root,s=d,l=o.cmdRepos.get(t.__commandId_PCEFlexUI);if(!l||!l.ignoreState){let r=e(t);l.isPressed.value()?r.addClass("pressed"):r.hasClass("viewStateSelected")||r.removeClass("pressed"),s.visibility.update(t,l.isVisible.value),s.enable.update(t,l.isActive.value)}}},d.dynhtml={init:function(){return{controlsDescendantBindings:!0}},update:function(e,r,n,a,i){t.utils.setHtml(e,r()),t.applyBindingsToDescendants(i,e)}},d.gesture={init:function(e){t.utils.domNodeDisposal.addDisposeCallback(e,(function(){o.remove(e)}))},update:function(e,n,i,s,l){r.ObjectManager.trigger();const d=t.unwrap(n());function c(t){try{let r,n,a,i=t.target||e.id;if(null!==o.getElementById(i))return;t.containment&&(r=o.calculateContainmentByElement(t.containment),n=t.containment.element);let s=t.grid;"function"==typeof t.grid&&(s=t.grid()),a="string"==typeof s?o.calculateGridByElement(s):s,o.add({element:e,target:t.target?document.getElementById(t.target):e,options:t.options||{},gestures:t.gestures,containment:r,containerId:n,grid:a,listElementName:t.listElementName,verticalScrollbarElementName:t.verticalScrollbarElement,horizontalScrollbarElementName:t.horizontalScrollbarElement,notificationHandler:t.notifications})}catch(e){r.designMode?Wincor.UI.Service.Provider.LogProvider.error("ko.bindingHandlers.gesture "+e):Wincor.UI.Service.Provider.propagateError("ko.bindingHandlers.gesture","OTHER",e)}}a.Promises.promise(((e,t)=>{if(l.$root.viewHelper.isPopupMessageActive()){if(!r.designMode){const t=Wincor.UI.Service.Provider.ViewService;t.registerForServiceEvent(t.SERVICE_EVENTS.POPUP_ACTIVATED,e,t.DISPOSAL_TRIGGER_ONETIME)}}else e()})).then((()=>{if(l.$root.viewActivated()&&!d.activationPromise)c(d);else{let e=[l.$root.vmContainer.whenActivated()];d.activationPromise&&d.activationPromise.then&&e.push(d.activationPromise),a.Promises.Promise.all(e).then(function(e){c(e)}.bind(null,d))}}))}},d.autoSizeInputFont={init:function(r,n,a,i,o){t.unwrap(n());let s=e(r).css("font-size");if(r.__maxFontSize=parseInt(s.substr(0,s.length-2)),o.$root.viewHelper.isPopupMessageActive()){const t=Wincor.UI.Service.Provider.ViewService;t.registerForServiceEvent(t.SERVICE_EVENTS.POPUP_ACTIVATED,(()=>{e(r).inputfit({maxSize:r.__maxFontSize})}),t.DISPOSAL_TRIGGER_ONETIME)}},update:function(r,n){t.unwrap(n());Wincor.UI.Content.ViewModelContainer.whenActivated().then((()=>{e(r).inputfit({maxSize:r.__maxFontSize})}))}},d.enable={update:function(e,r){let n=t.utils.unwrapObservable(r());n&&e.hasAttribute("disabled")?e.removeAttribute("disabled"):n||e.hasAttribute("disabled")||e.setAttribute("disabled","disabled")}},d}));